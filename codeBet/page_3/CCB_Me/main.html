<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDBonlineDisplay</title>
    <style>
        body {
        padding: 0;
        margin: 0;
        overflow: hidden;
        }
        a{  
            position: fixed;
            left: 10px;
            top: 10px;
            background-color: rgba(255,255,255,0.5);
            z-index: 10001;
            border-radius: 3px;
            padding: 2px;
            text-decoration: none;
            color: rgb(128, 0, 117);
        }
        main{
            pointer-events: none;
        }
    </style>
    <script type="text/javascript">
        function stop() {
            return false;
        }
        document.oncontextmenu = stop;
    </script>
    <script src="../../../p5.min.js"></script>
    <script>
        var gm=null;
        function Player(){
            this.position=createVector(width/2,height/2);
            this.maxSpeed=2;
            this.size=9;
            this.gunpodList=[];
            this.maxHealthBar=100;
            this.healthBar=this.maxHealthBar;
            this.enemyList=null;
            this.addEnemylist=function(enemyList){
                this.enemyList=enemyList;
            }
            this.move=function(direction){
                if(direction=="UP" && this.position.y-this.size/2>0){
                    this.position.y-=this.maxSpeed;
                }else if(direction=="DOWN" && this.position.y+this.size/2<height){
                    this.position.y+=this.maxSpeed;
                }else if(direction=="LEFT" && this.position.x-this.size/2>0){
                    this.position.x-=this.maxSpeed;
                }else if(direction=="RIGHT" && this.position.x+this.size/2<width){
                    this.position.x+=this.maxSpeed;
                }
            }
            this.shot=function(type){
                var mousePosition=createVector(mouseX,mouseY);
                var gunpodVelocity=p5.Vector.sub(mousePosition,this.position);
                gunpodVelocity.normalize();
                if(type=="NORMALE1"){
                    this.gunpodList.push(new Gunpod(this.position.x,this.position.y,gunpodVelocity.x,gunpodVelocity.y,150,222,100));
                }
            }
            this.display=function(){
                push();
                translate(this.position.x,this.position.y);
                noStroke();
                fill(255,125,202);
                circle(0,0,this.size);
                pop();
            }
            this.displayHealthBar=function(){
                push();
                translate(this.position.x,this.position.y);
                rectMode(CORNERS);
                noStroke();
                fill(10,255,10,200);
                rect(-30,-30,map(this.healthBar,0,this.maxHealthBar,-30,30),-34);
                noFill();
                stroke(222);
                rect(-30,-30,30,-34);
                pop();
            }
            this.run=function(){
                for(var i=0;i<this.gunpodList.length;i++){
                    this.gunpodList[i].update();
                    this.gunpodList[i].display();
                    if(this.gunpodList[i].checkInScreen()==false){
                        this.gunpodList.splice(i,1);
                    }
                    for(var j=0;j<this.enemyList.length;j++){
                        if(this.gunpodList[i].checkBump(this.enemyList[j])){
                            this.enemyList[j].healthBar-=1;
                        }
                    }
                }
                if(keyIsDown(87) || keyIsDown(83) || keyIsDown(65) || keyIsDown(68)){
                    if(keyCode==87){
                        this.move("UP");
                    }else if(keyCode==83){
                        this.move("DOWN");
                    }else if(keyCode==65){
                        this.move("LEFT");
                    }else if(keyCode==68){
                        this.move("RIGHT");
                    }
                }
                
                this.shot("NORMALE1");

                if(this.healthBar<=0){
                    noLoop();
                }
                this.display();
                this.displayHealthBar();
            }
        }
        function Gunpod(x,y,vx,vy,r,g,b){
            this.size=2;
            this.position=createVector(x,y);
            this.velocity=createVector(vx,vy);
            this.speed=3;
            this.r=r;this.g=g;this.b=b;
            this.velocity.mult(this.speed);
            this.update=function(){
                this.position.add(this.velocity);
            }
            this.checkBump=function(target){
                if(dist(this.position.x,this.position.y,target.position.x,target.position.y)<this.size/2+target.size/2){
                    return(true);
                }else{
                    return(false);
                }
            }
            this.checkInScreen=function(){
                if(this.position.x<-500 || this.position.x>width+500 || this.position.y<-500 || this.position.y>height+500){
                    return(false);
                }else{
                    return(true);
                }
            }
            this.display=function(){
                fill(this.r,this.g,this.b);
                noStroke();
                circle(this.position.x,this.position.y,this.size);
            }
        }
        function Enemy(player){
            this.isdead=false;
            this.type=int(random(1,4));
            this.position=createVector(random(100,width-100),random(100,height-100));
            this.velocity=p5.Vector.random2D();
            this.velocity.normalize();
            this.hitTimeCount=random(0,4);
            this.isHit=false;
            this.maxSpeed=2;
            this.size=9;
            this.angle=0;
            this.gunpodList=[];
            this.maxHealthBar=80;
            this.healthBar=this.maxHealthBar;
            this.player=player
            this.hit=function(){
                this.isHit=true;
            }
            this.shot=function(type){
                if(this.type==1){
                    var playerPosition=createVector(this.player.position.x,this.player.position.y);
                    var gunpodVelocity=p5.Vector.sub(playerPosition,this.position);
                    gunpodVelocity.normalize();
                    if(type=="NORMALE1"){
                        this.gunpodList.push(new Gunpod(this.position.x,this.position.y,gunpodVelocity.x,gunpodVelocity.y,255,100,0));
                    }
                }else if(this.type==2){
                    var direction=createVector(sin(this.angle),cos(this.angle));
                    this.angle+=0.02;
                    direction.normalize();
                    if(type=="NORMALE1"){
                        this.gunpodList.push(new Gunpod(this.position.x,this.position.y,direction.x,direction.y,255,0,121));
                    }
                }else if(this.type==3){
                    var direction=p5.Vector.random2D();
                    direction.normalize();
                    if(type=="NORMALE1"){
                        this.gunpodList.push(new Gunpod(this.position.x,this.position.y,direction.x,direction.y,0,121,255));
                    }
                }
            }
            this.display=function(){
                push();
                translate(this.position.x,this.position.y);
                if(this.isHit){
                    if(this.hitTimeCount<=255){
                        this.hitTimeCount+=5;
                        fill(240,10,10,255-this.hitTimeCount);
                        noStroke();
                        circle(0,0,this.hitTimeCount);
                    }else{
                        this.isdead=true;
                    }
                }
                noStroke();
                fill(125,222,202);
                circle(0,0,this.size);
                pop();
            }
            this.displayHealthBar=function(){
                push();
                translate(this.position.x,this.position.y);
                rectMode(CORNERS);
                noStroke();
                fill(10,255,10,200);
                if(this.healthBar>=0){
                    rect(-30,-30,map(this.healthBar,0,this.maxHealthBar,-30,30),-34);
                }
                noFill();
                stroke(222);
                rect(-30,-30,30,-34);
                pop();
            }
            this.update=function(){
                this.checkEdges();
                this.position.add(this.velocity);
            }
            this.checkEdges=function(){//check if the ball hit the edge
                if(this.position.x-this.size/2<0 || this.position.x+this.size/2>width){
                    if(this.position.x-this.size/2<0){
                        this.position.x=this.size/2;
                    }else{
                        this.position.x=width-this.size/2;
                    }
                    this.velocity.x*=-1;
                }
                if(this.position.y-this.size/2<0 || this.position.y+this.size/2>height){
                    if(this.position.y-this.size/2<0){
                        this.position.y=this.size/2;
                    }else{
                        this.position.y=height-this.size/2;
                    }
                    this.velocity.y*=-1;
                }
            }
            this.run=function(){
                for(var i=0;i<this.gunpodList.length;i++){
                    this.gunpodList[i].update();
                    this.gunpodList[i].display();
                    if(this.gunpodList[i].checkInScreen()==false){
                        this.gunpodList.splice(i,1);
                    }
                    if(this.gunpodList[i].checkBump(this.player)){
                        this.player.healthBar-=1;
                    }
                }
                if(this.healthBar<=0){
                    this.hit();
                }
                
                if(frameCount%4==1){
                    this.shot("NORMALE1");
                }

                this.update();
                this.display();
                this.displayHealthBar();
            }
        }
        function GameManager(){
            this.player=new Player;
            this.enemyList=[];
            for(var i=0;i<10;i++){
                this.enemyList.push(new Enemy(this.player));
            }
            this.player.addEnemylist(this.enemyList);
            this.run=function(){
                this.player.run();
                for(var i=0;i<this.enemyList.length;i++){
                    this.enemyList[i].run();
                    if(this.enemyList[i].isdead){
                        this.enemyList.splice(i,1);
                    }
                }
            }
        }
        function setup() {
            createCanvas(windowWidth, windowHeight);
            smooth();
            gm=new GameManager;
        }
        function keyPressed(){
            
        }
        function windowResized() {
            resizeCanvas(windowWidth,windowHeight);
        }
        function draw(){
            background(0,150);
            gm.run();
        }
    </script>
    </head>

    <body>
    <main>
        
    </main>
    
    </body>
</html>